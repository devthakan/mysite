<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡§ï‡§æ‡§®‡•ã‡§°‡§º GSSS ¬∑ ‡§ï‡•ç‡§≤‡•á‡§Æ ‡§´‡•â‡§∞‡•ç‡§Æ (Aadhaar ‡§∏‡§∞‡•ç‡§ö)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;              /* slate-900 */
      --bg-soft:#111827;         /* gray-900 */
      --card:#0b1222;            /* custom dark card */
      --accent:#4f46e5;          /* indigo-600 */
      --accent-2:#22d3ee;        /* cyan-400 */
      --text:#e5e7eb;            /* gray-200 */
      --muted:#94a3b8;           /* slate-400 */
      --ring: rgba(99,102,241,.35);
      --ok:#10b981;              /* emerald-500 */
      --warn:#ef4444;            /* red-500 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background: radial-gradient(1200px 600px at 10% -10%, rgba(79,70,229,.35), transparent 60%),
                               radial-gradient(900px 500px at 100% 0%, rgba(34,211,238,.25), transparent 55%),
                               linear-gradient(180deg, #0b1020, #0a0f1b 30%, #070b13);
         color:var(--text);font-family:"Inter","Noto Sans Devanagari",system-ui,Segoe UI,Roboto,Arial,sans-serif;}

    /* Top Appbar */
    .appbar{position:sticky;top:0;z-index:40;backdrop-filter:saturate(1.4) blur(8px);
      background:rgba(7,11,19,.6);border-bottom:1px solid rgba(255,255,255,.06)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:10px;background:conic-gradient(from 0deg, var(--accent), var(--accent-2)); box-shadow:0 0 0 4px rgba(255,255,255,.05) inset}
    .brand h1{font-size:18px;margin:0;letter-spacing:.2px}

    /* Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 10px 40px rgba(0,0,0,.35); padding:22px}

    /* Inputs */
    label{display:block;margin:12px 0 6px;font-weight:600;color:var(--muted)}
    input,button{width:100%;padding:12px 14px;border:1px solid rgba(255,255,255,.12);border-radius:12px;font-size:15px;background:rgba(255,255,255,.04);color:var(--text)}
    input::placeholder{color:#9aa6b2}
    input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
    .row{display:grid;grid-template-columns:1fr 160px;gap:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{color:var(--muted);font-size:13px}

    /* Buttons */
    .btn{background:linear-gradient(135deg, var(--accent), #6a5cff); color:#fff; border:0; cursor:pointer; font-weight:700; letter-spacing:.2px}
    .btn:disabled{opacity:.7;cursor:not-allowed}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,.15)}
    .right{text-align:right}

    /* Pills & Divider */
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(79,70,229,.15);color:#c7d2fe;font-weight:700;font-size:12px;border:1px solid rgba(79,70,229,.30)}
    .divider{height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);margin:18px 0}

    /* States */
    .warn{color:#fecaca}
    .success{color:#bbf7d0}

    /* Skeleton */
    .skeleton{position:relative;overflow:hidden;background:rgba(255,255,255,.06);border-radius:10px;height:44px}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);
      background:linear-gradient(90deg, transparent, rgba(255,255,255,.18), transparent);
      animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}

    /* Loader Overlay */
    .overlay{position:fixed;inset:0;background:rgba(2,6,12,.65);backdrop-filter:blur(6px) saturate(1.2);display:none;align-items:center;justify-content:center;z-index:60}
    .overlay.active{display:flex}
    .loader{width:96px;height:96px;border-radius:50%;
      background:
        radial-gradient(farthest-side, rgba(255,255,255,.95) 92%, transparent) top/12px 12px no-repeat,
        conic-gradient(from 0deg, var(--accent) 0 25%, transparent 0 50%, var(--accent-2) 0 75%, transparent 0);
      mask: radial-gradient(farthest-side, transparent 52%, #000 53%);
      animation:spin 1.1s linear infinite}
    @keyframes spin{to{transform:rotate(1turn)}}
    .overlay .msg{margin-top:16px;text-align:center;color:#e2e8f0;font-weight:600}

    /* Icon bullets */
    .pill svg{width:14px;height:14px}

    @media (max-width:680px){ .grid{grid-template-columns:1fr} .row{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Appbar -->
  <header class="appbar">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div class="brand">
        <div class="logo"></div>
        <h1>‡§ï‡§æ‡§®‡•ã‡§°‡§º ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡•á‡§µ‡§æ ‡§∏‡§π‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§Æ‡§ø‡§§‡§ø ¬∑ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h1>
      </div>
      <div class="muted" style="font-weight:600">‡§ï‡•ç‡§≤‡•á‡§Æ ‡§´‡•â‡§∞‡•ç‡§Æ / Aadhaar ‡§∏‡§∞‡•ç‡§ö</div>
    </div>
  </header>

  <!-- Main -->
  <main class="container" style="padding-top:24px; padding-bottom:40px;">
    <section class="card">
      <label>‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ (12 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ)</label>
      <div class="row">
        <input id="aadhar" maxlength="12" placeholder="‡§â‡§¶‡§æ. 123412341234" />
        <button class="btn" id="btnSearch">‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
      </div>
      <div id="msg" class="muted" style="margin-top:10px"></div>

      <div id="memberBox" style="display:none;margin-top:16px;">
        <div class="divider"></div>
        <span class="pill">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 7L9 18l-5-5" stroke="#c7d2fe" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§°‡•á‡§ü‡§æ
        </span>

        <div id="skeletonBlock" style="display:none; margin-top:12px" class="grid">
          <div class="skeleton"></div><div class="skeleton"></div>
          <div class="skeleton"></div><div class="skeleton"></div>
          <div class="skeleton"></div><div class="skeleton"></div>
          <div class="skeleton"></div>
        </div>

        <div id="dataGrid" style="margin-top:12px" class="grid">
          <div><label>‡§®‡§æ‡§Æ</label><input id="m_name" disabled></div>
          <div><label>DMR ‡§®‡§Ç‡§¨‡§∞</label><input id="m_dmr" disabled></div>
          <div><label>‡§ñ‡§æ‡§§‡§æ ‡§®‡§Ç‡§¨‡§∞</label><input id="m_ac" disabled></div>
          <div><label>BL ‡§®‡§Ç‡§¨‡§∞</label><input id="m_bl" disabled></div>
          <div><label>‡§ã‡§£ ‡§§‡§ø‡§•‡§ø</label><input id="m_loan" disabled></div>
          <div><label>‡§∞‡§æ‡§∂‡§ø</label><input id="m_amount" disabled></div>
          <div><label>‡§ú‡§®‡•ç‡§Æ ‡§§‡§ø‡§•‡§ø (DOB)</label><input id="m_dob" disabled></div>
        </div>

        <div class="divider"></div>
        <span class="pill">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 6v6l4 2" stroke="#c7d2fe" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          ‡§ï‡§ø‡§∏‡§æ‡§® ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§≠‡§∞‡§®‡§æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø
        </span>
        <div class="grid" style="margin-top:12px;">
          <div><label>‡§®‡•â‡§Æ‡§ø‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ *</label><input id="f_nom" placeholder="‡§®‡•â‡§Æ‡§ø‡§®‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ"></div>
          <div><label>‡§®‡•â‡§Æ‡§ø‡§®‡•Ä ‡§∏‡•á ‡§∞‡§ø‡§∂‡•ç‡§§‡§æ *</label><input id="f_rel" placeholder="‡§â‡§¶‡§æ. ‡§™‡•Å‡§§‡•ç‡§∞/‡§™‡§§‡•ç‡§®‡•Ä"></div>
          <div><label>‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§ï‡•Ä ‡§§‡§ø‡§•‡§ø (DOD) *</label><input id="f_dod" type="date"></div>
          <div><label>‡§â‡§Æ‡•ç‡§∞ (‡§µ‡§∞‡•ç‡§∑)</label><input id="f_age" disabled></div>
        </div>

        <div class="divider"></div>
        <div class="right" style="display:flex; gap:10px; justify-content:flex-end;">
          <button class="btn secondary" id="btnClear">‡§∞‡•Ä‡§∏‡•á‡§ü</button>
          <button class="btn" id="btnDownload">‡§´‡•â‡§∞‡•ç‡§Æ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° (PDF)</button>
        </div>
        <div id="msg2" class="muted" style="margin-top:10px;"></div>
      </div>
    </section>
  </main>

  <!-- Overlay Loader -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div>
      <div class="loader" aria-label="Loading"></div>
      <div class="msg">PDF ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç</div>
    </div>
  </div>

  <script>
    // üîß ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ GAS Web App URL ( /exec ) ‡§°‡§æ‡§≤‡•á‡§Ç
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzSlMasAM3HOsVAmthFzQ741hHuXL53BLrYQZiYkHwFHE2oUKYOunk3DRVZw6TYaeodVA/exec";

    const $ = (id)=>document.getElementById(id);
    $('btnSearch').addEventListener('click', onSearch);
    $('f_dod').addEventListener('change', updateAgePreview);
    $('btnDownload').addEventListener('click', onDownload);
    $('btnClear').addEventListener('click', clearForm);

    let currentMaster = null;

    function showSkeleton(b){
      $('skeletonBlock').style.display = b? 'grid':'none';
      $('dataGrid').style.opacity = b? .25:1;
    }
    function showOverlay(b){
      const ov = $('overlay');
      if(b){ ov.classList.add('active'); ov.setAttribute('aria-hidden','false'); }
      else { ov.classList.remove('active'); ov.setAttribute('aria-hidden','true'); }
    }

    async function onSearch(){
      const aadhar = $('aadhar').value.trim();
      $('msg').textContent = '';
      if(!/^\d{12}$/.test(aadhar)){
        $('msg').innerHTML = '<span class="warn">‡§ï‡•É‡§™‡§Ø‡§æ 12 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡•à‡§ß ‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</span>';
        $('memberBox').style.display = 'none';
        return;
      }
      setLoading(true); showSkeleton(true);
      try{
        const form = new URLSearchParams();
        form.append('action','search');
        form.append('aadhar', aadhar);
        const res = await fetch(WEB_APP_URL, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body: form.toString() });
        const json = await res.json();
        if(!json.ok){
          $('msg').innerHTML = '<span class="warn">'+(json.error||'‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ')+'</span>';
          $('memberBox').style.display = 'none';
          setLoading(false); showSkeleton(false);
          return;
        }
        currentMaster = json.data || null;
        fillMaster(currentMaster);
        $('msg').innerHTML = '<span class="success">‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§</span>';
        $('memberBox').style.display = 'block';
      }catch(err){
        $('msg').innerHTML = '<span class="warn">‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: '+err+'</span>';
        $('memberBox').style.display = 'none';
      }finally{
        setLoading(false); showSkeleton(false);
      }
    }

    function fillMaster(m){
      $('m_name').value = m.name || '';
      $('m_dmr').value = m.dmr_number || '';
      $('m_ac').value = m.account_number || '';
      $('m_bl').value = m.bl_number || '';
      $('m_loan').value = m.date_of_loan || '';
      $('m_amount').value = (m.amount!=null? m.amount : '');
      $('m_dob').value = m.date_of_birth || '';

      $('f_nom').value = '';
      $('f_rel').value = '';
      $('f_dod').value = '';
      $('f_age').value = '';
    }

    function updateAgePreview(){
      const dobStr = $('m_dob').value; // yyyy-mm-dd from server
      const dodStr = $('f_dod').value; // yyyy-mm-dd from input
      if(!dobStr || !dodStr){ $('f_age').value=''; return; }
      const dob = new Date(dobStr);
      const dod = new Date(dodStr);
      if(isNaN(dob.getTime()) || isNaN(dod.getTime())){ $('f_age').value=''; return; }
      let age = dod.getFullYear()-dob.getFullYear();
      const m = dod.getMonth()-dob.getMonth();
      if(m<0 || (m===0 && dod.getDate()<dob.getDate())) age--; if(age<0) age=0;
      $('f_age').value = age;
    }

    async function onDownload(){
      if(!currentMaster){ $('msg2').innerHTML = '<span class="warn">‡§™‡§π‡§≤‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§∏‡•á ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§</span>'; return; }
      const nominee_name = $('f_nom').value.trim();
      const nominee_relation = $('f_rel').value.trim();
      const date_of_death = $('f_dod').value; // yyyy-mm-dd
      if(!nominee_name || !nominee_relation || !date_of_death){
        $('msg2').innerHTML = '<span class="warn">‡§®‡•â‡§Æ‡§ø‡§®‡•Ä ‡§®‡§æ‡§Æ, ‡§∞‡§ø‡§∂‡•ç‡§§‡§æ ‡§î‡§∞ ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å-‡§§‡§ø‡§•‡§ø ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§π‡•à‡§Ç‡•§</span>';
        return;
      }

      $('msg2').textContent = 'PDF ‡§¨‡§® ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶';
      setLoading(true); showOverlay(true);
      try{
        const form = new URLSearchParams();
        form.append('action','submit');
        form.append('aadhar_number', currentMaster.aadhar_number);
        form.append('nominee_name', nominee_name);
        form.append('nominee_relation', nominee_relation);
        form.append('date_of_death', date_of_death);

        const res = await fetch(WEB_APP_URL, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body: form.toString() });
        const json = await res.json();
        if(!json.ok){
          $('msg2').innerHTML = '<span class="warn">'+(json.error||'‡§§‡•ç‡§∞‡•Å‡§ü‡§ø')+'</span>';
          setLoading(false); showOverlay(false); return;
        }
        const filename = json.filename || ('claim.pdf');
        const base64 = json.pdfBase64;
        downloadBase64(base64, filename, 'application/pdf');
        $('msg2').innerHTML = '<span class="success">PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§î‡§∞ ‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ‡•§</span>';
      }catch(err){
        $('msg2').innerHTML = '<span class="warn">‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: '+err+'</span>';
      }finally{
        setLoading(false); showOverlay(false);
      }
    }

    function downloadBase64(base64, filename, mime){
      const link = document.createElement('a');
      link.href = 'data:'+mime+';base64,'+base64;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    function clearForm(){
      $('aadhar').value = '';
      $('memberBox').style.display = 'none';
      $('msg').textContent = '';
      $('msg2').textContent = '';
    }

    function setLoading(b){
      $('btnSearch').disabled = b; $('btnDownload').disabled = b;
    }
  </script>
</body>
</html>
