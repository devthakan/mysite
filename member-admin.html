<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Member Admin – Add Membership</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    html, body { background:#0f172a; }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,0.08); }
    .hidden { display:none; }
  </style>
</head>
<body class="min-h-screen text-slate-100">
  <div class="max-w-3xl mx-auto p-4 md:p-8">
    <header class="mb-6">
      <h1 class="text-2xl md:text-3xl font-bold text-white">Member Admin – Add Membership</h1>
      <p class="text-slate-300 mt-1">members तालिका में सदस्य जोड़ें</p>
    </header>

    <section class="glass rounded-2xl p-4 md:p-6 border border-white/10 mb-8">
      <div class="grid md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm mb-1">सदस्यता संख्या</label>
          <input id="m_no" inputmode="numeric" pattern="\d{1,12}" maxlength="12" class="w-full bg-slate-800/70 border border-white/10 rounded-xl p-3" placeholder="उदा. 123456" required />
        </div>
        <div>
          <label class="block text-sm mb-1">कृषक का नाम</label>
          <input id="m_name" class="w-full bg-slate-800/70 border border-white/10 rounded-xl p-3 uppercase" pattern="[A-Z ]+" required oninput="this.value=this.value.toUpperCase().replace(/[^A-Z ]/g,'')" />
        </div>
        <div>
          <label class="block text-sm mb-1">पिता/पति का नाम</label>
          <input id="m_father" class="w-full bg-slate-800/70 border border-white/10 rounded-xl p-3 uppercase" pattern="[A-Z ]+" required oninput="this.value=this.value.toUpperCase().replace(/[^A-Z ]/g,'')" />
        </div>
      </div>
      <div class="mt-4 flex gap-3">
        <button id="btn_add" class="px-5 py-3 rounded-xl bg-emerald-500 text-slate-900 font-semibold">Add Member</button>
        <span id="msg" class="text-slate-300"></span>
      </div>
    </section>

    <section class="glass rounded-2xl p-4 md:p-6 border border-white/10">
      <h2 class="text-xl font-semibold mb-3">Recent Members</h2>
      <div id="list" class="text-slate-200 text-sm"></div>
      <button id="refresh" class="mt-3 px-3 py-2 rounded-lg bg-slate-700">Refresh</button>
    </section>
  </div>

  <script>
    const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co"; // <-- वही values लगाएँ
    const SUPABASE_KEY = "YOUR-ANON-KEY";                    // <-- वही values लगाएँ
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const $=id=>document.getElementById(id);

    async function addMember(){
      const membership_no = $('m_no').value.trim();
      const farmer_name = $('m_name').value.trim().toUpperCase();
      const guardian_name = $('m_father').value.trim().toUpperCase();
      if(!membership_no || !farmer_name || !guardian_name){ $('msg').textContent='कृपया सभी फील्ड भरें'; return; }

      // check duplicate
      const { data:ex } = await supabase.from('members').select('membership_no').eq('membership_no', membership_no).maybeSingle();
      if(ex){ $('msg').textContent='यह सदस्य संख्या पहले से मौजूद है'; return; }

      const { error } = await supabase.from('members').insert({ membership_no, farmer_name, guardian_name });
      if(error){ console.error(error); $('msg').textContent='Error: insert failed'; return; }
      $('msg').textContent='जोड़ा गया ✔';
      $('m_no').value=''; $('m_name').value=''; $('m_father').value='';
      loadMembers();
    }

    async function loadMembers(){
      const { data, error } = await supabase
        .from('members')
        .select('membership_no, farmer_name, guardian_name')
        .order('membership_no', { ascending: true })
        .limit(20);
      if(error){ console.error(error); $('list').textContent='Load error'; return; }
      if(!data?.length){ $('list').textContent='कोई रिकॉर्ड नहीं'; return; }
      const rows = data.map(r=>`<div class="flex justify-between border-b border-white/10 py-2"><span>#${r.membership_no}</span><span>${r.farmer_name}</span><span>${r.guardian_name}</span></div>`).join('');
      $('list').innerHTML = rows;
    }

    $('btn_add').addEventListener('click', addMember);
    $('refresh').addEventListener('click', loadMembers);
    loadMembers();
  </script>
</body>
</html>
