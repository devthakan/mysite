<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡§ï‡§æ‡§®‡•ã‡§°‡§º GSSS ‚Äî ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root{
      --bg:#0b1020;
      --card:#0f162e;
      --muted:#9aa4b2;
      --text:#eaf0ff;
      --accent:#4f46e5;
      --accent-2:#22c55e;
      --danger:#ef4444;
      --border:#1f2742;
      --chip:#1b2140;
      --chip-2:#152036;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 80% -10%, #1a2245 0%, transparent 60%),
                  radial-gradient(800px 500px at -10% 10%, #1f2a55 0%, transparent 60%),
                  linear-gradient(180deg, #091021 0%, #0b1020 100%);
      color:var(--text);
      font-family:"Inter","Noto Sans Devanagari", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      letter-spacing:0.1px;
    }
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:16px;margin:8px 0 18px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#4f46e5,#22c55e);display:grid;place-items:center; font-weight:700}
    .logo span{background:#fff;color:#111;padding:4px 6px;border-radius:8px;font-size:12px}
    .titles h1{margin:0;font-size:22px;font-weight:700;letter-spacing:0.2px}
    .titles p{margin:2px 0 0;color:var(--muted);font-size:13px}

    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:14px;border-bottom:1px solid var(--border)}
    .toolbar .chip{background:var(--chip);border:1px solid var(--border);padding:8px 10px;border-radius:12px;font-size:13px;color:var(--muted)}
    .toolbar input[type="text"], .toolbar select{
      background:#0c1330;border:1px solid var(--border);color:var(--text);
      padding:10px 12px;border-radius:12px;outline:none; font-size:14px;min-width:240px;
    }
    .toolbar .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#121a37;color:var(--text);cursor:pointer;font-weight:600}
    .toolbar .btn.primary{background:var(--accent);border-color:#3f3ab7}
    .toolbar .btn.ghost{background:#11172f}
    .toolbar .btn.success{background:var(--accent-2);border-color:#169c46}

    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:0;background:linear-gradient(180deg,#121a37,#0e1530);border-bottom:1px solid var(--border);
      color:#b9c4d6;text-align:left;font-weight:600;padding:12px 10px;font-size:12px;letter-spacing:0.4px;text-transform:uppercase}
    tbody td{border-bottom:1px solid var(--border);padding:12px 10px;font-size:14px;color:#e8eeff}
    tbody tr:hover{background:#0f1733}
    tbody tr.editing{background:#0b1533}
    .td-small{font-size:12px;color:#a8b3c9}
    .status{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:var(--chip-2);font-size:12px}
    .status.done{background:rgba(34,197,94,0.15);border-color:rgba(34,197,94,0.35)}
    .status.baki{background:rgba(239,68,68,0.14);border-color:rgba(239,68,68,0.35)}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#121a37;border:1px solid var(--border);font-size:12px;color:#9fb0cb}

    .table-wrap{max-height:65vh;overflow:auto;border-radius:0 0 18px 18px}

    .footbar{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-top:1px solid var(--border)}
    .footbar .page{display:flex;gap:8px;align-items:center}
    .footbar button{background:#11172f;border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}

    .right-actions{display:flex;gap:8px}
    .action{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#0e1530;cursor:pointer;font-size:13px}
    .action.save{background:var(--accent)}
    .action.danger{background:var(--danger)}

    /* Login Screen */
    .auth{max-width:420px;margin:9vh auto;padding:22px}
    .auth h2{margin:0 0 8px}
    .auth p{margin:0 0 16px;color:var(--muted)}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field input{background:#0c1330;border:1px solid var(--border);color:var(--text);
      padding:12px;border-radius:12px;outline:none;font-size:14px}

    .hint{font-size:12px;color:var(--muted)}
    .divider{height:1px;background:var(--border);margin:16px 0}

    .hidden{display:none !important}

    .toast{position:fixed;right:16px;bottom:16px;background:#101936;color:var(--text);padding:12px 16px;border:1px solid var(--border);border-radius:12px;opacity:0;transform:translateY(10px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}

    .tag{padding:4px 8px;border-radius:8px;background:#101838;border:1px solid var(--border);font-size:12px;color:#b8c3d8}

    .loader{width:18px;height:18px;border-radius:50%;border:3px solid #2c365f;border-top-color:#fff;display:inline-block;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .overlay{position:fixed;inset:0;background:rgba(8,12,24,.55);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:10}
    .overlay.show{display:flex}
    .overlay .box{background:#0e1530;border:1px solid var(--border);padding:16px 18px;border-radius:12px;display:flex;gap:10px;align-items:center}

    .muted{color:var(--muted)}
    .kbd{background:#101838;border:1px solid var(--border);padding:2px 6px;border-radius:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:12px;color:#a8b5d0}

    .selectable{user-select:all}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">G</div>
        <div class="titles">
          <h1>‡§ï‡§æ‡§®‡•ã‡§°‡§º ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡•á‡§µ‡§æ ‡§∏‡§π‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§Æ‡§ø‡§§‡§ø ‚Äî ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§ø‡§ï‡§µ‡§∞‡•Ä ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</h1>
          <p>Supabase ‡§∏‡•á ‡§≤‡§æ‡§á‡§µ ‡§°‡•á‡§ü‡§æ ‚Ä¢ ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ: <span class="tag">recovrybakimember</span></p>
        </div>
      </div>
      <div id="userBox" class="hidden">
        <span class="muted">‡§≤‡•â‡§ó‡§ø‡§®:</span> <span id="userEmail" class="selectable"></span>
        <button id="btnLogout" class="action" title="Logout">Logout</button>
      </div>
    </header>

    <!-- AUTH CARD -->
    <section id="authCard" class="card auth">
      <h2>‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
      <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç (Supabase Auth).</p>
      <div class="field">
        <label>‡§à‡§Æ‡•á‡§≤</label>
        <input id="email" type="email" placeholder="you@example.com" autocomplete="username" />
      </div>
      <div class="field">
        <label>‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
        <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
      </div>
      <div class="field">
        <button id="btnLogin" class="toolbar btn primary" style="width:100%">‡§≤‡•â‡§ó‡§ø‡§®</button>
      </div>
      <div class="hint">‡§®‡•ã‡§ü: ‡§Ø‡§π ‡§™‡•á‡§ú GitHub Pages ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§ Supabase URL ‡§î‡§∞ ANON KEY ‡§®‡•Ä‡§ö‡•á JS ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§</div>
      <div class="divider"></div>
      <div class="hint">‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§§‡•ã Supabase ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§∏‡•á ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç‡•§</div>
    </section>

    <!-- MAIN CARD -->
    <section id="mainCard" class="card hidden">
      <div class="toolbar">
        <span class="chip">üîé ‡§ñ‡•ã‡§ú</span>
        <input id="q" type="text" placeholder="A/c, ‡§Ü‡§ß‡§æ‡§∞, ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ñ‡•ã‡§ú‡•á‡§Ç (‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 2 ‡§Ö‡§ï‡•ç‡§∑‡§∞)‚Ä¶" inputmode="search" />
        <label class="chip"><input id="onlyBaki" type="checkbox" style="vertical-align:middle;transform:translateY(1px);margin-right:6px"> ‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§¨‡§ï‡§æ‡§Ø‡§æ</label>
        <select id="yearFilter">
          <option value="">‡§∏‡§≠‡•Ä ‡§µ‡§∞‡•ç‡§∑</option>
          <option>2022</option>
          <option>2023</option>
          <option>2024</option>
          <option>2025</option>
        </select>
        <button id="refreshBtn" class="btn ghost">Refresh</button>
        <span class="chip nowrap">‡§ï‡•Å‡§≤ <span id="totalCount">0</span> ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°</span>
        <div style="flex:1"></div>
        <button id="addQuickDone" class="btn success" title="‡§ö‡•Å‡§®‡•á ‡§π‡•Å‡§è ‡§ï‡•ã Done ‡§ï‡§∞‡•á‡§Ç" disabled>Mark Done (Selected)</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:46px">#</th>
              <th>‡§Ü‡§ß‡§æ‡§∞</th>
              <th>‡§®‡§æ‡§Æ</th>
              <th>‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
              <th>‡§ñ‡§æ‡§§‡§æ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ</th>
              <th>‡§∞‡§æ‡§∂‡§ø</th>
              <th>Interest/DMR</th>
              <th>‡§µ‡§∞‡•ç‡§∑</th>
              <th>‡§∏‡•ç‡§ü‡•á‡§ü‡§∏</th>
              <th style="width:180px">‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="footbar">
        <div class="page">
          <button id="prev">‚óÄÔ∏é</button>
          <span class="chip">Page <span id="pageNo">1</span></span>
          <button id="next">‚ñ∂Ô∏é</button>
          <span class="chip">‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•á‡§ú: <span class="kbd">25</span></span>
        </div>
        <div class="right-actions">
          <span class="hint">‡§∏‡§Ç‡§™‡§æ‡§¶‡§® ‡§ï‡•á ‡§≤‡§ø‡§è <span class="kbd">Edit</span> ‚Üí <span class="kbd">Save</span> ‡§ï‡§∞‡•á‡§Ç</span>
        </div>
      </div>
    </section>
  </div>

  <div id="overlay" class="overlay"><div class="box"><span class="loader"></span> <span id="overlayText">Loading‚Ä¶</span></div></div>
  <div id="toast" class="toast"></div>

  <script>
    // ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è 1) ‡§Ø‡§π‡§æ‡§Å ‡§Ö‡§™‡§®‡§æ Supabase ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
    const SUPABASE_URL = "https://sjfglhxjdyvcygunijvz.supabase.co"; // TODO: ‡§¨‡§¶‡§≤‡•á‡§Ç
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNqZmdsaHhqZHl2Y3lndW5panZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkyMDcsImV4cCI6MjA3MDgyNTIwN30.HduOuf_wdZ4iHHNN26ECilX_ALCHfnPPC07gYPN2tsM";              // TODO: ‡§¨‡§¶‡§≤‡•á‡§Ç

    // üîé Basic sanity check so you don't forget to set keys
    if (SUPABASE_URL.includes("YOUR-PROJECT") || SUPABASE_ANON_KEY.includes("YOUR_ANON_KEY")) {
      alert("‚ö†Ô∏è Supabase URL/Anon Key ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (JS ‡§ï‡•á ‡§ä‡§™‡§∞). ‡§§‡§¨ ‡§π‡•Ä Login ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ.");
    }

    // 2) ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§Ü‡§™‡§®‡•á ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à):
    const TABLE = "recovrybakimember";

    // 3) ‡§™‡•á‡§ú ‡§∏‡§æ‡§á‡§ú
    const PAGE_SIZE = 25;

    // 4) Supabase client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true }
    });

    // UI elements
    const authCard = document.getElementById('authCard');
    const mainCard = document.getElementById('mainCard');
    const userBox = document.getElementById('userBox');
    const userEmail = document.getElementById('userEmail');
    const btnLogout = document.getElementById('btnLogout');
    const btnLogin = document.getElementById('btnLogin');
    const email = document.getElementById('email');
    const password = document.getElementById('password');

    const q = document.getElementById('q');
    const onlyBaki = document.getElementById('onlyBaki');
    const yearFilter = document.getElementById('yearFilter');
    const tbody = document.getElementById('tbody');
    const totalCount = document.getElementById('totalCount');
    const pageNo = document.getElementById('pageNo');
    const nextBtn = document.getElementById('next');
    const prevBtn = document.getElementById('prev');
    const refreshBtn = document.getElementById('refreshBtn');
    const addQuickDone = document.getElementById('addQuickDone');

    const overlay = document.getElementById('overlay');
    const overlayText = document.getElementById('overlayText');
    const toast = document.getElementById('toast');

    let state = {
      page: 1,
      search: '',
      onlyBaki: false,
      year: '',
      selected: new Set(),
      total: 0
    };

    // Helpers
    const showToast = (msg) => {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 2200);
    }
    const showOverlay = (msg = 'Processing‚Ä¶') => { overlayText.textContent = msg; overlay.classList.add('show') }
    const hideOverlay = () => overlay.classList.remove('show');

    const formatMoney = (x) => {
      const n = Number(x);
      if (Number.isFinite(n)) return n.toLocaleString('en-IN');
      return x ?? '';
    }

    // Auth flow
    async function applyAuthUI(session){
      if(session){
        userEmail.textContent = session.user?.email || '';
        userBox.classList.remove('hidden');
        authCard.classList.add('hidden');
        mainCard.classList.remove('hidden');
        await loadPage();
      } else {
        userBox.classList.add('hidden');
        mainCard.classList.add('hidden');
        authCard.classList.remove('hidden');
      }
    }

    async function init(){
      // Tiny ping to show where we are running from
      console.log('Origin:', location.origin);
      console.log('Supabase URL:', SUPABASE_URL);
      const { data: { session } } = await supabase.auth.getSession();
      await applyAuthUI(session);
      supabase.auth.onAuthStateChange(async (_evt, sess) => {
        await applyAuthUI(sess);
      });
      // Connectivity self-test (helps spot bad URL/Key)
      try{
        const { data, error } = await supabase.from(TABLE).select('sn').limit(1);
        if(error){ console.warn('DB preflight (expected before login):', error.message); }
        else { console.log('DB reachable, rows sample:', data?.length); }
      }catch(e){ console.warn('Preflight error:', e); }
    } } = await supabase.auth.getSession();
      await applyAuthUI(session);
      supabase.auth.onAuthStateChange(async (_evt, sess) => {
        await applyAuthUI(sess);
      });
    }

    btnLogin?.addEventListener('click', async () => {
      const mail = email.value.trim();
      const pass = password.value;
      if(!mail || !pass){ showToast('‡§à‡§Æ‡•á‡§≤/‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç'); return; }
      try{
        showOverlay('‡§≤‡•â‡§ó‡§ø‡§® ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶');
        const { data, error } = await supabase.auth.signInWithPassword({ email: mail, password: pass });
        if(error){
          console.error('Auth Error:', error);
          let msg = '‡§≤‡•â‡§ó‡§ø‡§® ‡§µ‡§ø‡§´‡§≤';
          const m = (error.message||'').toLowerCase();
          if(m.includes('invalid login credentials')) msg = '‡§ó‡§≤‡§§ ‡§à‡§Æ‡•á‡§≤/‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°';
          else if(m.includes('email not confirmed') || m.includes('confirmation')) msg = '‡§à‡§Æ‡•á‡§≤ confirm ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‚Äî Supabase ‚Üí Auth ‚Üí Users ‡§Æ‡•á‡§Ç ‡§á‡§∏ user ‡§ï‡•ã Confirm ‡§ï‡§∞ ‡§¶‡•á‡§Ç ‡§Ø‡§æ Email confirmations disable ‡§ï‡§∞‡•á‡§Ç';
          else if(m.includes('invalid api key') || m.includes('api key')) msg = 'API Key/URL ‡§ó‡§≤‡§§ ‡§π‡•à ‚Äî Project settings ‚Üí API ‡§∏‡•á ‡§∏‡§π‡•Ä URL/Anon key ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç';
          else if(m.includes('cors')) msg = 'CORS issue ‚Äî Auth ‚Üí URL config ‡§Æ‡•á‡§Ç Site URL ‡§î‡§∞ GitHub Pages domain ‡§ú‡•ã‡§°‡§º‡•á‡§Ç';
          showToast(msg);
          return;
        }
        // Optional: verify session/user
        const { data: u } = await supabase.auth.getUser();
        if(!u?.user){ showToast('‡§∏‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§®‡§æ ‚Äî URL/KEY ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç'); return; }
        showToast('‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤');
      }catch(err){
        console.error(err); showToast('‡§≤‡•â‡§ó‡§ø‡§® ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + (err.message || err));
      }finally{ hideOverlay(); }
    });
        if(error) throw error;
        showToast('‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤');
      }catch(err){
        console.error(err); showToast('‡§≤‡•â‡§ó‡§ø‡§® ‡§µ‡§ø‡§´‡§≤: ' + (err.message || err));
      }finally{ hideOverlay(); }
    });
    btnLogout?.addEventListener('click', async ()=>{
      showOverlay('‡§≤‡•â‡§ó‡§Ü‡§â‡§ü‚Ä¶');
      await supabase.auth.signOut();
      hideOverlay();
      showToast('‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ');
    });

    // Data fetching
    async function loadPage(){
      try{
        showOverlay('‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶');
        const from = (state.page-1)*PAGE_SIZE; const to = from + PAGE_SIZE - 1;
        let query = supabase.from(TABLE)
          .select('sn, adhar_number, name, father_name, account_number, amount, intrestdmr_number, year, recovery_done', { count: 'exact' })
          .order('sn', { ascending: true })
          .range(from, to);

        if(state.search && state.search.length >= 2){
          const s = state.search;
          // account_number & adhar_number ko text ‡§Æ‡§æ‡§®‡•á‡§Ç
          query = query.or(
            `account_number.ilike.%${s}%,adhar_number.ilike.%${s}%,name.ilike.%${s}%,father_name.ilike.%${s}%`
          );
        }
        if(state.onlyBaki){
          // recovery_done = false ‡§Æ‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç (BOOLEAN). ‡§Ø‡§¶‡§ø TEXT ‡§π‡•à ‡§§‡•ã ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç TRUE/FALSE ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§
          query = query.eq('recovery_done', false);
        }
        if(state.year){ query = query.eq('year', state.year); }

        const { data, error, count } = await query;
        if(error) throw error;
        state.total = count || 0;
        totalCount.textContent = state.total;
        pageNo.textContent = state.page;
        renderRows(data || []);
      }catch(err){
        console.error(err); showToast('‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + (err.message || err));
      }finally{ hideOverlay(); }
    }

    function renderRows(rows){
      tbody.innerHTML = '';
      addQuickDone.disabled = state.selected.size === 0;

      rows.forEach(row => {
        const tr = document.createElement('tr');
        tr.dataset.sn = row.sn;
        const status = (row.recovery_done === true || row.recovery_done === 'true' || row.recovery_done === 'done' || row.recovery_done === 'YES');
        tr.innerHTML = `
          <td><label style="display:flex;gap:8px;align-items:center"><input type="checkbox" class="rowCheck"> <span class="td-small">${row.sn ?? ''}</span></label></td>
          <td class="nowrap">${escapeHtml(row.adhar_number)}</td>
          <td>${escapeHtml(row.name)}</td>
          <td>${escapeHtml(row.father_name)}</td>
          <td class="nowrap">${escapeHtml(row.account_number)}</td>
          <td><span class="pill">‚Çπ ${formatMoney(row.amount)}</span></td>
          <td>${escapeHtml(row.intrestdmr_number)}</td>
          <td class="nowrap">${escapeHtml(row.year)}</td>
          <td>
            <span class="status ${status? 'done':'baki'}">${status? 'Done':'Baki'}</span>
          </td>
          <td>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="action edit">Edit</button>
              <button class="action save hidden">Save</button>
              <button class="action danger cancel hidden">Cancel</button>
            </div>
          </td>
        `;

        // Attach events
        tr.querySelector('.rowCheck').addEventListener('change', (e)=>{
          const checked = e.target.checked;
          if(checked) state.selected.add(row.sn); else state.selected.delete(row.sn);
          addQuickDone.disabled = state.selected.size === 0;
        });

        const btnEdit = tr.querySelector('.edit');
        const btnSave = tr.querySelector('.save');
        const btnCancel = tr.querySelector('.cancel');

        btnEdit.addEventListener('click', ()=> startEdit(tr, row));
        btnSave.addEventListener('click', ()=> saveEdit(tr, row.sn));
        btnCancel.addEventListener('click', ()=> cancelEdit(tr));

        tbody.appendChild(tr);
      });
    }

    function startEdit(tr, row){
      if(tr.classList.contains('editing')) return;
      tr.classList.add('editing');
      const tds = tr.querySelectorAll('td');
      const [_, tdAadhar, tdName, tdFather, tdAcc, tdAmt, tdInt, tdYear, tdStatus] = tds;

      // Replace with inputs (as text)
      tdAadhar.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdAadhar.textContent)}" />`;
      tdName.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdName.textContent)}" />`;
      tdFather.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdFather.textContent)}" />`;
      tdAcc.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdAcc.textContent)}" />`;
      tdAmt.innerHTML = `<input class="inp" type="number" step="0.01" value="${String((tdAmt.textContent||'').replace(/[^0-9.]/g,''))}" />`;
      tdInt.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdInt.textContent)}" />`;
      tdYear.innerHTML = `<input class="inp" type="text" value="${escapeAttr(tdYear.textContent)}" />`;
      tdStatus.innerHTML = `
        <label class="status ${/Done/i.test(tdStatus.textContent)?'done':'baki'}">
          <input id="chkDone" type="checkbox" ${/Done/i.test(tdStatus.textContent)?'checked':''} style="margin-right:8px"> Done
        </label>`;

      tr.querySelector('.edit').classList.add('hidden');
      tr.querySelector('.save').classList.remove('hidden');
      tr.querySelector('.cancel').classList.remove('hidden');

      // Style inputs
      tr.querySelectorAll('.inp').forEach(inp=>{
        inp.style.background = '#0c1330';
        inp.style.border = '1px solid var(--border)';
        inp.style.color = 'var(--text)';
        inp.style.padding = '8px 10px';
        inp.style.borderRadius = '10px';
        inp.style.minWidth = '100px';
      });
    }

    function collectRowEdits(tr){
      const tds = tr.querySelectorAll('td');
      const [_, tdAadhar, tdName, tdFather, tdAcc, tdAmt, tdInt, tdYear] = tds;
      return {
        adhar_number: tdAadhar.querySelector('input')?.value?.trim() ?? null,
        name: tdName.querySelector('input')?.value?.trim() ?? null,
        father_name: tdFather.querySelector('input')?.value?.trim() ?? null,
        account_number: tdAcc.querySelector('input')?.value?.trim() ?? null,
        amount: tdAmt.querySelector('input')?.value ?? null,
        intrestdmr_number: tdInt.querySelector('input')?.value?.trim() ?? null,
        year: tdYear.querySelector('input')?.value?.trim() ?? null,
        recovery_done: tr.querySelector('#chkDone')?.checked ?? false
      };
    }

    async function saveEdit(tr, sn){
      try{
        const updates = collectRowEdits(tr);
        showOverlay('‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶');
        const { error } = await supabase.from(TABLE).update(updates).eq('sn', sn);
        if(error) throw error;
        showToast('‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡•á‡§µ ‡§π‡•Å‡§Ü');
        // Reload current page
        await loadPage();
      }catch(err){
        console.error(err); showToast('‡§∏‡•á‡§µ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + (err.message || err));
      }finally{ hideOverlay(); }
    }

    function cancelEdit(tr){
      tr.classList.remove('editing');
      // ‡§¨‡§∏ ‡§™‡•á‡§ú ‡§∞‡•Ä‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç
      loadPage();
    }

    // Bulk quick done
    addQuickDone.addEventListener('click', async ()=>{
      if(state.selected.size === 0) return;
      try{
        showOverlay('Bulk update‚Ä¶');
        const ids = Array.from(state.selected);
        const { error } = await supabase.from(TABLE).update({ recovery_done: true }).in('sn', ids);
        if(error) throw error;
        showToast('‡§ö‡•Å‡§®‡•á ‡§π‡•Å‡§è ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° Done');
        state.selected.clear();
        await loadPage();
      }catch(err){ console.error(err); showToast('Bulk ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: '+(err.message||err)); }
      finally{ hideOverlay(); }
    });

    // Search & filters
    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); } }
    q.addEventListener('input', debounce(()=>{ state.search = q.value.trim(); state.page = 1; loadPage(); }, 350));
    onlyBaki.addEventListener('change', ()=>{ state.onlyBaki = !!onlyBaki.checked; state.page = 1; loadPage(); })
    yearFilter.addEventListener('change', ()=>{ state.year = yearFilter.value || ''; state.page = 1; loadPage(); })
    refreshBtn.addEventListener('click', ()=> loadPage());

    nextBtn.addEventListener('click', ()=>{
      const maxPage = Math.max(1, Math.ceil(state.total / PAGE_SIZE));
      if(state.page < maxPage){ state.page++; loadPage(); }
    });
    prevBtn.addEventListener('click', ()=>{ if(state.page>1){ state.page--; loadPage(); }});

    // Utils: simple HTML escaping
    function escapeHtml(str){
      if(str === null || str === undefined) return '';
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }
    function escapeAttr(str){ return escapeHtml(str).replaceAll('"','&quot;'); }

    // Kickoff
    init();
  </script>

  <!--
  üîß QUICK SETUP (Supabase)
  1) ‡§ä‡§™‡§∞ JS ‡§Æ‡•á‡§Ç SUPABASE_URL ‡§î‡§∞ SUPABASE_ANON_KEY ‡§≠‡§∞‡•á‡§Ç‡•§
  2) ‡§§‡§æ‡§≤‡§ø‡§ï‡§æ: recovrybakimember (columns: sn [PK], adhar_number, name, father_name, account_number, amount, intrestdmr_number, year, recovery_done [BOOLEAN])
  3) RLS (Row Level Security) ON ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ø‡§π ‡§¨‡•á‡§∏‡§ø‡§ï ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§≤‡§ó‡§æ‡§è‡§Å (‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‚Üí SQL):

     alter table recovrybakimember enable row level security;
     create policy "read_all_auth" on recovrybakimember for select
       to authenticated using (true);
     create policy "update_all_auth" on recovrybakimember for update
       to authenticated using (true) with check (true);

     (Production ‡§Æ‡•á‡§Ç ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§î‡§∞ ‡§∏‡§ñ‡§º‡•ç‡§§ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç)

  4) Supabase Auth ‡§Æ‡•á‡§Ç ‡§à‡§Æ‡•á‡§≤/‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§¨‡§®‡§æ ‡§≤‡•á‡§Ç‡•§
  5) ‡§á‡§∏ ‡§è‡§ï ‡§´‡§æ‡§á‡§≤ ‡§ï‡•ã GitHub Pages ‡§™‡§∞ ‡§π‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞ ‡§¶‡•Ä‡§ú‡§ø‡§è ‚Äî ‡§∏‡§¨ ‡§ö‡§≤ ‡§™‡§°‡§º‡•á‡§ó‡§æ ‚úÖ
  -->
</body>
</html>
