<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>‡§ï‡§ø‡§∏‡§æ‡§® ‚Äì ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ñ‡•ã‡§ú</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    html, body {
      background:
        radial-gradient(1200px 800px at 10% 10%, #0ea5e94d, transparent),
        radial-gradient(900px 700px at 90% 20%, #22c55e33, transparent),
        #0b1220;
    }
    .glass { backdrop-filter: blur(16px); background: rgba(255,255,255,0.06); }
    .hidden{ display:none; }
    .focusy:focus { outline:none; box-shadow: 0 0 0 3px rgba(34,197,94,.35); border-color: rgba(255,255,255,.25); }
  </style>
</head>
<body class="min-h-screen text-slate-100">
  <div class="max-w-4xl mx-auto p-4 md:p-8">
    <header class="mb-6 md:mb-8">
      <h1 class="text-2xl md:text-3xl font-extrabold">‡§ï‡§ø‡§∏‡§æ‡§® ‚Äì ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§ñ‡•ã‡§ú</h1>
    </header>

    <section class="glass rounded-2xl p-5 md:p-7 border border-white/10 shadow-2xl">
      <div class="grid md:grid-cols-[1fr_auto] gap-3 items-end">
        <div>
          <label for="ac" class="block text-sm mb-1">SB A/C No. (17 ‡§Ö‡§Ç‡§ï)</label>
          <input id="ac" type="text" inputmode="numeric" maxlength="17" pattern="\d{17}"
                 class="w-full bg-slate-900/60 border border-white/10 rounded-xl p-3 focusy"
                 placeholder="‡§â‡§¶‡§æ. 00012345678901234" />
        </div>
        <button id="findBtn" class="px-5 py-3 rounded-xl bg-indigo-500 text-slate-900 font-semibold hover:brightness-110">
          ‡§ñ‡•ã‡§ú‡•á‡§Ç
        </button>
      </div>

      <p id="status" class="mt-3 text-sm text-slate-300"></p>

      <div id="card" class="hidden mt-6 border border-white/10 rounded-2xl p-4 bg-slate-900/40">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><div class="text-slate-400 text-xs mb-1">APP. NO.</div><div id="r_app" class="text-base md:text-lg font-semibold"></div></div>
          <div><div class="text-slate-400 text-xs mb-1">CUSTOMER NAME</div><div id="r_cust" class="text-base md:text-lg font-semibold"></div></div>
          <div><div class="text-slate-400 text-xs mb-1">FATHER NAME</div><div id="r_father" class="text-base md:text-lg font-semibold"></div></div>
          <div><div class="text-slate-400 text-xs mb-1">SB A/C NO.</div><div id="r_ac" class="text-base md:text-lg font-semibold"></div></div>
          <div class="md:col-span-2"><div class="text-slate-400 text-xs mb-1">SHARE CAPITAL</div><div id="r_share" class="text-xl font-extrabold text-emerald-400"></div></div>
        </div>
        <p id="more" class="text-xs text-slate-400 mt-3 hidden"></p>
      </div>
    </section>
  </div>

  <script>
    /* ==== CONFIG ==== */
    const SUPABASE_URL = "https://sjfglhxjdyvcygunijvz.supabase.co";  // ‚Üê ‡§Ö‡§™‡§®‡•Ä ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNqZmdsaHhqZHl2Y3lndW5panZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNDkyMDcsImV4cCI6MjA3MDgyNTIwN30.HduOuf_wdZ4iHHNN26ECilX_ALCHfnPPC07gYPN2tsM";                   // ‚Üê ‡§Ö‡§™‡§®‡•Ä ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç (anon)
    const TABLE = "share_capital";

    // DB ‡§ï‡•á ‡§ï‡•â‡§≤‡§Æ ‡§®‡§æ‡§Æ ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§ê‡§∏‡•á ‡§π‡•Ä:
    const COLS = {
      app_no:        "APP. NO.",
      customer_name: "CUSTOMER NAME",
      father_name:   "FATHER NAME",
      sb_ac_no:      "SB A/C NO.",
      share_capital: "SHARE CAPITAL"
    };

    /* ==== Helpers ==== */
    let sb = null;
    const $ = (id) => document.getElementById(id);
    const show = (el) => el.classList.remove("hidden");
    const hide = (el) => el.classList.add("hidden");
    const setStatus = (msg) => { $("status").textContent = msg || ""; };

    const cleanAC = (s) => String(s||"").replace(/\D+/g,""); // ‡§∏‡§ø‡§∞‡•ç‡§´ digits
    const quote = (name) => `"${String(name).replace(/"/g,'""')}"`; // PostgREST select ‡§ï‡•á ‡§≤‡§ø‡§è

    function fillCard(row){
      $("r_app").textContent    = row[COLS.app_no] ?? "";
      $("r_cust").textContent   = (row[COLS.customer_name]||"").toString().toUpperCase();
      $("r_father").textContent = (row[COLS.father_name]||"").toString().toUpperCase();
      $("r_ac").textContent     = row[COLS.sb_ac_no] ?? "";
      $("r_share").textContent  = row[COLS.share_capital] ?? "";
    }

    async function findByAccount(){
      hide($("card")); $("more").classList.add("hidden"); setStatus("");

      const ac = cleanAC($("ac").value);
      if(ac.length !== 17){ setStatus("‡§ï‡•É‡§™‡§Ø‡§æ 17 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ SB A/C No. ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç"); $("ac").focus(); return; }

      try{
        // select ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§π‡§∞ ‡§ï‡•â‡§≤‡§Æ ‡§ï‡•ã quote ‡§ï‡§∞‡•á‡§Ç (‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§®‡§æ‡§Æ‡•ã‡§Ç ‡§Æ‡•á‡§Ç space/dot ‡§π‡•à‡§Ç)
        const selectList = [
          COLS.app_no, COLS.customer_name, COLS.father_name, COLS.sb_ac_no, COLS.share_capital
        ].map(quote).join(", ");

        // üîß ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£: filter ‡§Æ‡•á‡§Ç column ‡§®‡§æ‡§Æ ‡§ï‡•ã **quoted** ‡§™‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø PostgREST ‡§∏‡§π‡•Ä ‡§™‡§¢‡§º‡•á
        const colQuoted = quote(COLS.sb_ac_no);

        const q = await sb
          .from(TABLE)
          .select(selectList)
          .filter(colQuoted, "eq", ac)     // <<‚Äî ‡§Ø‡§π‡•Ä fix
          .limit(20);

        if(q.error){ console.error(q.error); setStatus("‡§°‡•á‡§ü‡§æ ‡§™‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ"); return; }
        const rows = q.data || [];
        if(rows.length === 0){ setStatus("‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ"); return; }

        fillCard(rows[0]); show($("card"));
        if(rows.length > 1){
          $("more").textContent = `‡§®‡•ã‡§ü: ${rows.length-1} ‡§î‡§∞ ‡§Æ‡§ø‡§≤‡§æ‡§® ‡§π‡•à‡§Ç‡•§`;
          $("more").classList.remove("hidden");
        }
      }catch(e){
        console.error(e); setStatus("‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ");
      }
    }

    (function boot(){
      const init = () => {
        sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        $("findBtn").addEventListener("click", findByAccount);
        $("ac").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); findByAccount(); } });
      };
      if(document.readyState==="complete"||document.readyState==="interactive") setTimeout(init,0);
      else window.addEventListener("DOMContentLoaded", init);
    })();
  </script>
</body>
</html>
